'use strict';


// Prove mining nokubit
//	getblocktemplate

const crypto = require('crypto');
const http = require('http');
const info = require('./nkLib.js');


const isMain = require.main === module;
//console.log('ISMAIN:', isMain);

var netInfo;
if (isMain) {
	// E' OBBLIGATORIO il parametro chain:<nomechain>
	let chain;
	for (let i=2; i<process.argv.length; i++) {
		if (process.argv[i].startsWith('chain:')) {
			chain = process.argv[i].substring(6);
			break;
		}
	}
	if (!chain) {
		console.log('Il parametro chain:<nomechain> è obbligatorio');
		return;
	}
	netInfo = info.netInfo(chain);
} else {
	module.exports = function(cname) {
		if (!cname)
			throw 'cname undefined: must define chain name';

		netInfo = info.netInfo(cname);
		baseParam.nRPCPort = netInfo.nRPCPort;
		return {
			getBlockTemplate: getBlockTemplate,
			generateBlock: generateBlock
		};
	};
}

/*************************************************************************
 *
 * Questa è la chiave privata della chiave pubbilca PoA Noku inserita 
 * nel consensus del codice nokubit.
 *
 *   NATURALMENTE QUESTA E' UNA CHIAVE TEMPORANEA DA SOSTITUIRE
 *   CON LA VERA CHIAVE PRIVATA/PUBBLICA QUANDO IL SSTEMA VA IN
 *   TEST e/o PRODUZIONE
 *
 ************************************************************************/
const nkPoASkPem = 
'-----BEGIN EC PRIVATE KEY-----\n\
MHQCAQEEIPdGpqHbay2gtc4bPwfW+icll1T9n5rzruOwzbgkfRt5oAcGBSuBBAAK\n\
oUQDQgAEw/tIwS10euGbOwP05Q3g2blHc7xs43PrYsUjRvmEEb23+LgNkPOuVBrh\n\
TJxsStjtEb8DRtJuYl41X+ub5M9bmA==\n\
-----END EC PRIVATE KEY-----';

const masterKey = info.EcCrypto(nkPoASkPem);

// masterKey.checkPk2Sk(masterKey.publicKey);
// masterKey.checkPk2Sk(Buffer.from('02c3fb48c12d747ae19b3b03f4e50de0d9b94773bc6ce373eb62c52346f98411bd', 'hex'));
// masterKey.checkPk2Sk(Buffer.from('04C3FB48C12D747AE19B3B03F4E50DE0D9B94773BC6CE373EB62C52346F98411BDB7F8B80D90F3AE541AE14C9C6C4AD8ED11BF0346D26E625E355FEB9BE4CF5B98', 'hex'));
// console.log(masterKey.publicKey.toString('hex'));
// console.log(info.Hash160(masterKey.publicKey).reverse().toString('hex'));
// return;

const walletSkKey = 'a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5a5';
const walletKey = new info.EcCrypto({sk: walletSkKey});


// Devono corrispondere al file di configurazione
const rpcUser = 'nokubit';
const rpcPassword = 'dD0HaWmDb+5bRq3rSo23UzFTxmb7YmKzzM3bXNgpBjlDoFQJvftG/635suWEJNgk1ZeOAZRpDHUXFoBg';
const rpcHost = 'localhost';


const baseParam = {
	rpcUser: rpcUser,
	rpcPassword: rpcPassword,
	rpcHost: rpcHost,
	nRPCPort: (netInfo ? netInfo.nRPCPort : -1),
	callTimeout: 4000,

	signKey: masterKey,
	walletAddress: info.Hash160(walletKey.publicKey),
	blockData: undefined,
	powFunc: defaultPow,
	minerSign: 'Mined by mbert'
};
if (isMain) {
	let force = false;
	if (process.argv.length > 2) {
		if (process.argv[2] == 'force') {
			console.log('Force block');
			force = true;
		} else if (process.argv[2].startsWith('rpc=')) {
			console.log('remote', process.argv[2].substr(4));
			baseParam.rpcHost = process.argv[2].substr(4);
		}
	}

	getBlockTemplate(function(e, d) {
		if (e) {
			if (!force)
				throw e;
			getBlockchainInfo(function(e, d) {
				console.log(e, d);
			});
		} else {
			if (d.blockData.transactions.length == 0 && d.blockData.mintime + 4 * 3600 > d.blockData.curtime) {
			 	console.log('No pending tx');
			 	return;
			} else if (d.blockData.transactions.length < 10 && d.blockData.mintime + 20 > d.blockData.curtime) {
				console.log('Pending tx < 10');
				return;
		   }
		   generateBlock(d);
		}
	});
}

// Response
const chaininfo = {
	chain: 'main',
	blocks: 0,
	headers: 0,
	bestblockhash: '000000000002372343785ee8ff3cf5af1638edd078d19c1d03008cf9aadae0da',
	difficulty: 1,
	mediantime: 1231006505,
	verificationprogress: 2.669959962602031e-9,
	initialblockdownload: true,
	chainwork: '0000000000000000000000000000000000000000000000000000000100010001',
	size_on_disk: 295,
	pruned: false,
	softforks: [
		{ id: 'bip34', version: 2, reject: { status: false } },
	   	{ id: 'bip66', version: 3, reject: { status: false } },
	   	{ id: 'bip65', version: 4, reject: { status: false } }
	],
	bip9_softforks: {
		csv: {
			status: 'active',
			startTime: -1,
			timeout: 9223372036854776000,
			since: 0
		},
	   	segwit: {
			status: 'active',
		  	startTime: -1,
		  	timeout: 9223372036854776000,
			  since: 0
		}
	},
	warnings: ''
};

const example = { capabilities: [ 'proposal' ],
  version: 536870912,
  rules: [ 'csv', 'segwit' ],
  vbavailable: {},
  vbrequired: 0,
  previousblockhash: '000001494d48d865ded31579aabe8efbf42412cc5c0f0a283746c3c03ec12619',
  transactions: [  ],
  coinbaseaux: { flags: '' },
  coinbasevalue: 0,
  longpollid: '000001494d48d865ded31579aabe8efbf42412cc5c0f0a283746c3c03ec126195',
  target: '00000000ffff0000000000000000000000000000000000000000000000000000',
  mintime: 1535913806,
  mutable: [ 'time', 'transactions', 'prevblock', ],
  noncerange: '00000000ffffffff',
  sigoplimit: 80000,
  sizelimit: 4000000,
  weightlimit: 4000000,
  curtime: 1536166792,
  bits: '1d00ffff',
  height: 5
};

const example2 = {
	capabilities: [ 'proposal'],
	version: 536870912,
	rules: [ 'csv', 'segwit'],
	vbavailable: {},
	vbrequired: 0,
	previousblockhash: '000001557bbc5a0f9b307bbf0497541caa12da8425a79f0da0dcfec6baf5e81e',
	transactions: 
 	[ {
		data: '02000000000101b8b4662238a180db4cb03c9ee3439f4115119bb6875ece850bbaf698ba5e75010000008000ffffffff0100981e0c5402000000160014291b2109be564dac10066335f611a4be7e8da8b0029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb407000df3e149aa7e0ab9bf916b207594a1f5d8e3d58b25ec888306a960344e54fbff0000000080220c5402000000473045022100aa776f5844ab1d4f9a5897b9fec2d07963ea61a1e638b24fd09ad35182fcea16022018501fe5423e8aaef51711f63ec24518baa08ba9ed7364f455d4ddf1e7eaced817a914e7c054f18f36059eac4699999020de43aa12396c8700000000',
	 	txid: '4e42194902ceb08d28dd4abb413c66bf9faf048eadf7bdd3740ab611d3010806',
	 	hash: '376896be6cb8c9804a0981b1910385ba88078e067407636f9d2706523f1798b3',
	 	depends: [],
	 	fee: 1000,
	 	sigops: 1,
		weight: 516
	}, {
		data: '02000000000102816df6eb7429d7fca980b8e95e0144cfa1ba99e47015b8ad6e87e51c1f8498230000008000ffffffff060801d311b60a74d3bdf7ad8e04af9fbf663c41bb4add288db0ce024919424e0000000000ffffffff02000000000000000000196a175072696e63697061746f204469204d6f6e61636f204f4e0088f70b5402000000160014291b2109be564dac10066335f611a4be7e8da8b0028e6e6b626f145072696e63697061746f204469204d6f6e61636f18422642205072696e63697061746f204469204d6f6e61636fdd0d776ec425b31c9738deba8fa2c4821d6177bd0146304402201514b6765bd58ee9d9c8aa0a1d0fbca0ed21b88b4082b6a2e228de7d4107b7f6022029497d0befd20d1751699afd8d394b233d4c2ba8e6b0e044fca74bdad4e058e917a914b6728174bec7ab09701e0ea86f4a2407a60ef6308702483045022100ded23dba0d1471790ed059b1e1145458582a31fecc9f48b575a46d40cab7092502200d9347f19f176de468db26426190ac6919c5c1fc507e3ee3e886469c145406d0012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
	 	txid: '6dfc4c12d3deb58c894a1156f21de0c3fd76aacd1484ecde68f3594f94c9381d',
	 	hash: 'f2c7962a9d64a0984bdb7d12b10ebab3ecce54a483bc832ec073343a69286b4b',
	 	depends: [ 1 ],
	 	fee: 10000,
	 	sigops: 2,
		weight: 914
	}, {
		data: '02000000000102f0ee816736c83604263e0715a7e6473fec6f1c51504b1576378758ec1536177f0000008000ffffffff1d38c9944f59f368deec8414cdaa76fdc3e01df256114a898cb5ded3124cfc6d0100000000ffffffff020953706963265370616e40912c9f03000000160014fc7250a211deddc70ee5a2738de5f07817351cef0078d00b5402000000160014291b2109be564dac10066335f611a4be7e8da8b002ba6e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b989000000000000000000000000000000000000000040912c9f030000000100483046022100bf68773ecc2ea99b76d2e400b49c740465fa4503a62b7c13ef2e7cc78780e4c7022100f3ee7d0773f64fc716637974101e3caae2090b3171e2bc23555e0450d8d17f5017a9143eb50cb15dcfc800fce8c78fa19ae0cfa93af39d8702483045022100bf3aa628833b09aed11cb846a1dad81fa56434482abf29b077d1e2182eb6886002205b5c60b112901181b5df6dac10632bf05fb6b853c150c765700af03e7efed2ef012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
	 	txid: '0c9857ca4aaea38f505808344ee03d96f0e88e2be7f0bb2e590c80fe886ab83d',
	 	hash: '73799e8bc0aa89ae184859c36a374761f461e75440f11d0165dfaa73b252110b',
	 	depends: [ 2 ],
	 	fee: 10000,
	 	sigops: 2,
		weight: 982
	}, {
		data: '0200000000010205b6bad5fa54e6f2890f4950df0b0f7c0766d3aa91535d933a8e14163d4055230000008000ffffffff3db86a88fe800c592ebbf0e72b8ee8f0963de04e340858508fa3ae4aca57980c0100000000ffffffff020953706963265370616ee086f25c03000000160014531260aa2a199e228c537dfa42c82bea2c7c1f4d0068a90b5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b86e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000e086f25c030000000100463044022054aed50b6c297942c7d1395d27551fba4e77d6068673bc82f3af0038e8c9d98002205c0cd63fc43e9e47b85ec492f9307308d937383711cf45d3cd3e7364d1e80a2917a914458c3c9ac474a1df83bd9aeafdbe954c069ebdfa870248304502210091a0ea39a0bd991b9d58f4889dd3b928de9ebb33360d9442f58baed0c6dfa4620220539280e20f855f6856f5e9fcd25d47c456fe6756f44a6c035844a6eee2e2184b012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
	 	txid: '12c5c43a3c74e8e4c49162d1f95409e391ad2b6dea3a02d5c212b9abc55b215d',
	 	hash: '3ace6acb215644ceb6b887a8f4d8a4a7b1f82c141d184ec4d9aa23817aeabd0c',
	 	depends: [ 3 ],
	 	fee: 10000,
	 	sigops: 2,
		weight: 980
	}, {
		data: '02000000000102c1451f8aaa4d0e47153985e3275a24fa970d870b7d7d3cca05c75029ccd726b20000008000ffffffff5d215bc5abb912c2d5023aea6d2bad91e30954f9d16291c4e4e8743c3ac4c5120100000000ffffffff020953706963265370616e807cb81a030000001600143bc28d6d92d9073fb5e3adf481795eaf446bceed0058820b5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b96e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000807cb81a03000000010047304502205142f257b44d411b321ff930569dd7fe26bc604a497f27caa35ad0ad60342c10022100d2dfa67b830809bac84136be8330538ea52c604bee06190a31862bc6c919ddda17a9146d242270dc468048628e9fe11a177e7a1a0dd3f287024830450221009e903c7123327dff5e86d51a64f2b5df243e763fba92ad527f1833121fc26c52022045ffd24cdd725a7523c50050b086b2c13c1f109c3ad8383382a8794e6af42b5a012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
	 	txid: '6458c3d3b2d3a9681426033673cb7a154aaa9cb9f9f5da03130762618ac7b334',
	 	hash: '7dd7fa496818cfa58006a9ed82f6479252c21e12d574bef521af1e677c38bac5',
	 	depends: [ 4 ],
	 	fee: 10000,
	 	sigops: 2,
		weight: 981
	}, {
		data: '02000000000102379e096859b40411da9fcc5018b5e8513d96c07a32e3aba97e2c46753ca46f7e0000008000ffffffff34b3c78a6162071303daf5f9b99caa4a157acb733603261468a9d3b2d3c358640100000000ffffffff020953706963265370616e20727ed802000000160014cc1b07838e387deacd0e5232e1e8b49f4c29e48400485b0b5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b86e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b989000000000000000000000000000000000000000020727ed802000000010046304402200fbfb93be9c06a0cf1772d4c4bd621c850a14c87818d480315bba786296c52f502207d1a300976f195d094b94e19e4400ef4622bb4ff97a6165d3f5a06ee317f1bf617a914aa60e530ca6f60820971af2bdd13a7ab26feae798702483045022100a8fae88f7663ecc5021206c428a9ab312e85545932e7a241741ef14ea469f90a02204c2af4e07822504bed2d4012676fa535af6957c0b918c5b5df2ad9be1389056a012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
	 	txid: 'a67eb27eef897f5d9744be67edf802b1fa6a9e3f7f04cc7f1eb1e0c3f5dbcf0e',
	 	hash: 'd58222b4d0a4bb9699034d881e56d67f3570b0d1d01ab99390bab2d9b8b8cd28',
	 	depends: [ 5 ],
	 	fee: 10000,
	 	sigops: 2,
		weight: 980
	}, {
		data: '0200000000010204660766a6a9109340c72d12aff1b5eec303cc5f259eb46d6930d68f424bb2c20000008000ffffffff0ecfdbf5c3e0b11e7fcc047f3f9e6afab102f8ed67be44975d7f89ef7eb27ea60100000000ffffffff020953706963265370616ec067449602000000160014e1fae3324e28a4ef5ee01f14dd337ac6c85d1d900038340b5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b86e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000c067449602000000010046304402204420e7fc0bf76d9fd5b4e1bd6c79573cb781974209e6afacdf203283130264a00220434a25865d82b6df2355f33317db37b70c703e1bb119137af7cb31c7e37bffbd17a914b7880ad2437c28dd08d1599b4df34bc255f743468702483045022100fbad1ee23e2c33079d2eda15fc9a1e52e591bc6e5e2b75e929224396c34ec4d60220358189ce28381200d19e7862854817400bbe8162e20596631f1554f936649989012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
	 	txid: '1e52019a957ac9f3784239d361b402ce57a8ae015ffae913ba9967dfd1051511',
	 	hash: '06f9eb3fc501412bb9b21e9c60db2e16176f7680ec97abfe9a0e6adea07272f3',
	 	depends: [ 6 ],
		fee: 10000,
		sigops: 2,
		weight: 980
	}, {
	   	data: '02000000000102ab551e0f0e2bf707c467f6a51037aa1e7808b7848a3b32c997e787df1f4b5bb90000008000ffffffff111505d1df6799ba13e9fa5f01aea857ce02b461d3394278f3c97a959a01521e0100000000ffffffff020953706963265370616e605d0a540200000016001492a01e34e09d999339ee9f2e4991e1c2571e7e9500280d0b5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b86e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000605d0a5402000000010046304402207701a9089ba9abf2bfc677a1064b91e315c5338a301f6d545c7651d6dddb9d4d0220773baa4f2b177c673a9c6d47356563af7f79b66621d9861675ea6396377c2b6b17a914305ac8dcc5434494a93a44c3d3c4a74117195936870247304402204173b095fdf2bd320e10ff9a32685030a46e9db4c6399e845d77a64c804d709c0220138ef52809fe155abf9d99d2267281f42f646dc5916f35a21cfbcd2f9d033c43012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: '01eefccfd5c01e4fdd1d13f4219f8d5b9e19406a834f2aee1c25aed5f744b4f4',
		hash: '13d0c407b76bd04ad95bf9421900faa07b5bf9bb6f6eaca35b409ac3ba6a0d1e',
		depends: [ 7 ],
		fee: 10000,
		sigops: 2,
		weight: 979
	}, { 
		data: '0200000000010213501744581bc26e1307298589b1656bd42700b02e53b1daf4747ca37fc9f16c0000008000fffffffff4b444f7d5ae251cee2a4f836a40199e5b8d9f21f4131ddd4f1ec0d5cffcee010100000000ffffffff020953706963265370616e0053d011020000001600140c15a4a3e98104afbf77fd7b9256164d41d3cfe40018e60a5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b86e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b98900000000000000000000000000000000000000000053d011020000000100463044022030c1a14a5f7b784736e937e20c6a75e926622cd387cce728fa8ac12af52a7a8d022028292d2123b08c10e2c1f527a9ad14bb348ad5ec542ffe6e0e4bb3085d28a35617a9147d9dd6c1d2944669219bf32ce836e6e0b5d4aa4d8702483045022100a0faf358f502bf5ab3d99ad3f85ad147fe230c7a96c15b8cdc848560fb5abbd7022067f3d34d8bbdc098f775fb065f01b3f938d5ace37c2bf27e61793877d111d1a2012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: 'd9661e5bc16cb673f6a972815082f0c957da062fd748a049d08d6d9ab40bcd0d',
		hash: '5589a8f92604ede72be4a9cb965a8f313924a84fe090753c4466d06d952fef72',
		depends: [ 8 ],
		fee: 10000,
		sigops: 2,
		weight: 980
	}, {
	   	data: '020000000001020b56e08466b9976a9324a11da4aa8935b038399edfe4eea110f465aba1aeb3ba0000008000ffffffff0dcd0bb49a6d8dd049a048d72f06da57c9f082508172a9f673b66cc15b1e66d90100000000ffffffff020953706963265370616ea04896cf01000000160014fce9025e95033dd6492459bd514883cf3911ee6e0008bf0a5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b96e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000a04896cf010000000100473045022100c2eb46e732a5f5ef75b2b701c5815a14b0726a173aa329179e84aa7b6e56aaf50220208157be079f568dea3c4ad2a8f5735933f27fdac16f035a3cc0604adc04e1bd17a914dd5635ba0cb0f4cad1684222f0f342ae3fd2f3e38702483045022100aa90ad0b5a5a3c03351b6ab8b2cf316a6924e906dd8e8ac2dada58517974d91802207131a9fe21abb9e80ff40b25f1e2bd7443cab3eb49205339e035e12d25488357012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: '4218e97152812d2b4969b08a91e4770c5173e66791f047acf4919cb5cd61fd31',
		hash: '4bea0d880c1decc2851a11388188bb0414cb98684effc912fd30ffe316afeef7',
		depends: [ 9 ],
		fee: 10000,
		sigops: 2,
		weight: 981
	}, {
	    data: '0200000000010247138af479d0624b886710234d6fc77b595e785239b2c7a8eb65fe86fe8aa4610000008000ffffffff31fd61cdb59c91f4ac47f09167e673510c77e4918ab069492b2d815271e918420100000000ffffffff020953706963265370616e403e5c8d01000000160014d2d97901ebbbaf97bbe7c7ac41ca578244d550a200f8970a5402000000160014291b2109be564dac10066335f611a4be7e8da8b002ba6e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000403e5c8d010000000100483046022100858039d564ae029eae762751b233e08838cfbe0737055818004f9e7baf4681f0022100c7151fd9a017d97769ac3f7937b1a33dbc1aab795ae719346e39885dd7f36c7917a914434d98e32958b311da8e35f953ecdf50c0b4d3d287024730440220421457d066ca0b881de2f94b2fefbc2e81b046353423a755cf6078db26960522022034267494051b52f1852f98886ce64af7ba38f2095d9891ae601dcbc6b8e5126e012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: '0c33b3e9d995fe7be99353971a17481b8b5e313c4f0e26014612dc9f9dded7a7',
		hash: '1179615659ffc3127d17e36a36856f06ba6db5fdd26de0b177fdc17c229c12b4',
		depends: [ 10 ],
		fee: 10000,
		sigops: 2,
		weight: 981
	}, {
		data: '020000000001022897952f7c38ef66ddb29892af65ae67fb732288b5bb72df634dbbf6e2dfdaf30000008000ffffffffa7d7de9d9fdc124601260e4f3c315e8b1b48171a975393e97bfe95d9e9b3330c0100000000ffffffff020953706963265370616ee033224b01000000160014113163f08f3587892b3b6df7d40f598b8037338e00e8700a5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b96e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000e033224b0100000001004730450220632c5ad4ba52012ced7a25a010d08e60684ed44f0439c11b3d05e409c9e67344022100eba00dba562c902d4e08abbfe641beedff4dd428dd36cacf9c6b7f8b988a609c17a914ab35fc59495534557ba0ca270162338ab6c859658702473044022006fdc0fa23e5405004ce224ed41a8bd9e4e6517da77e196951e596ebee0e2a7f02203a67b3a24265c71fd37b9940c21e1f1c801393d23db14904fe97710f1e3e2210012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: 'd55e846d07a8f4e5d738dfe4a4a0b80b65cd546e21631cd06f233c4cc7d19eaf',
		hash: '2d0ee47e5a0ab379af64dbecdeb9eb84725f6adfe5ab35a175c0d14bde8bb819',
		depends: [ 11 ],
		fee: 10000,
		sigops: 2,
		weight: 980
	}, {
		data: '0200000000010291b2ab842f66a998cbf8f5b918cc8f7fca0448d0b0ea1b8c01cbee0f8e0d56100000008000ffffffffaf9ed1c74c3c236fd01c63216e54cd650bb8a0a4e4df38d7e5f4a8076d845ed50100000000ffffffff020953706963265370616e8029e80801000000160014931a1af5d4f4858babe973d19cba07c041312d4d00d8490a5402000000160014291b2109be564dac10066335f611a4be7e8da8b002ba6e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b98900000000000000000000000000000000000000008029e808010000000100483046022100a38da46b2d02e3aacb09905ea740a30a81f8dc30b92c6c3dfdfe1d66205c142d022100e76366665cb65172706849bd1e478a0481f8e1fef979b47ac87677dbc00463fe17a914db64f98f5e54b0b9ddfd53e86f5802a12db5c7fe8702483045022100d150d66e07d7175591a49f16ab72d8845d735ecef17095e97ce975cd5b054449022029099341402eb67fef2ac6170f0625ffc2bed41a1351980e66c9f812ca083322012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: 'f8a048e6c8b9741ef99726f2e15080555963881eb949c7d6d56bdb2f27649616',
		hash: '943d3f74f16dd7f40418eb79897cb9cfec4acbbcdf18cb6843341126b4eeab1d',
		depends: [ 12 ],
		fee: 10000,
		sigops: 2,
		weight: 982
	}, {
		data: '020000000001023af6a0e4fb40a1e62d9b7645c15ed8d0e5711b68d1c2d0cf17cf5cda9f1b63380000008000ffffffff169664272fdb6bd5d6c749b91e886359558050e1f22697f91e74b9c8e648a0f80100000000ffffffff020953706963265370616e201faec60000000016001423204d103081b60db44bb8b9d881dc0db242bc3100c8220a5402000000160014291b2109be564dac10066335f611a4be7e8da8b002b86e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000201faec6000000000100463044022023ed75d9efdb81da3a1d84e3e1eabeed66007983bf328995b37beba94b2edf2b0220479812ec78f12a8d565487063a6a0f9be9fa42b63449fde1b748ea6c9a721b0c17a9141af763b8c83f3f422d052c66adbfc3630bb2b06087024730440220079d6e7b5503e48a25d2670a9ff8ea60fd85454a49557cd7799e5ae5e47d10b5022054825f3d772ebf3dc3e85e300bfc71db2a76d0aed052329cd018c0f753c468a6012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: '448a05de54b44eed271d1a32ddcd3de1b6eeaa12e612c5372fd9f38b6c29b711',
		hash: '4b60c2e7ae30b4f63579100ad24c185472c050c906c405a1830a18322408742a',
		depends: [ 13 ],
		fee: 10000,
		sigops: 2,
		weight: 979
	}, {
		data: '0200000000010208a359a6bb45cca526216db5916b4bd18deb8e21411075973061753c8fc1eff20000008000ffffffff11b7296c8bf3d92f37c512e612aaeeb6e13dcddd321a1d27ed4eb454de058a440100000000ffffffff020953706963265370616ec014748400000000160014e9d6beb11e577770ad1b6e4129a03554efbdca5200b8fb095402000000160014291b2109be564dac10066335f611a4be7e8da8b002b96e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000c0147484000000000100473045022100ef6df21d1278773bc91d8e30bdb0d7d11ccd2946f7e3a4b02e7e3b8275ea3ed102203f41660541897d249129f58af8c5f52b2ee43008f82b9d6fd5c9c01ea81af68c17a91422f5281416417cd1767d609d22c16039ada15543870247304402206d28fadc24e29036da5c34fbc7f218e23c9e0f0927303de3ef3a3300d2106220022024756ec07a935402f5dadacbba4bb96d84107a1b8d3e3ba0ab5cab1982295814012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: '882e703c72d5ca940f54f985dae38cd805af0dc1842ab47748bc3bdc35a773eb',
		hash: 'fc1590922fbb987aa4cda5b223eedd0fece3d14993920bf1868a5f92a3fb6b80',
		depends: [ 14 ],
		fee: 10000,
		sigops: 2,
		weight: 980
	}, {
		data: '020000000001025f73848a77990d39ff8e0fff35945bed9b2bbbf2e75d7a9e7801173b18043b640000008000ffffffffeb73a735dc3bbc4877b42a84c10daf05d88ce3da85f9540f94cad5723c702e880100000000ffffffff020953706963265370616e600a3a42000000001600145771f35d5fb212bf855900883bf92ce75c340c9500a8d4095402000000160014291b2109be564dac10066335f611a4be7e8da8b002ba6e6b626d0953706963265370616e22417373657420646574657267656e7465206368652065736973746520616e636f72612102dac1a06a52355a65baa8529924f568b15f0c2039f1068ee31082de62b821b9890000000000000000000000000000000000000000600a3a420000000001004830460221009caf915bfc9897fcab69ad18ffa9cdac88ae5c6e91625d368982299d4465050c0221009552b79f007c6c766577ee8a6454d90737b6d13ea9c187e65cd687103a307f7c17a9148be966bdb604f3eb6d7f52177178999df8cada7487024830450221009de0aaa6e9ec1ecd3c554856f44950f79126f698cb774bc16d48d64ddab427eb0220107859823cdbe8795ee2ac35109a7a531eb527424f09270ddcfbc7227e01464b012102e8c20537e368bbc1f15b99159088c265444bb3365cbea99c16f94bfddc23aeeb00000000',
		txid: 'b8875754e45983f95a1fedc4ef5640ffe6b4eb0f625fc82e19fe96e54737303c',
		hash: 'adc029e204409c173df7ec864b1f7d06d6c20516b775762e87dc1891be0cc589',
		depends: [ 15 ],
		fee: 10000,
		sigops: 2,
		weight: 982
	}, {
		data: '02000000000101ffcb02607ad2075dcf1d8ade7837a34d4bc67034ebe3c89c04bae96374bfa0fd0000008000ffffffff010098a051061f00000016001423204d103081b60db44bb8b9d881dc0db242bc31029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb4070087d3882616563915f8f1daed210ea2f3d626810c82fc6ff0823f7f676789864b0000000080a451061f000000473045022030ae28d14b36d849f95726e82035e14fdc162904d310a5168c928a11c0beade30221009b8bd90a2b5bf0f97d818b131423a60e186c897e904c862abbc64cb5cac4a58117a914f55ce54e075be1efe2a1516d999975922cab67148700000000',
		txid: '6eb0b162cdc91c75bb42a6655e36c2d954ea83df114c092cc28ea78fb6234616',
		hash: 'aaf38d8d9b24f32c3eb23a66b9a3a56ed75acf14dbcf1d2a94fa86e08bef8233',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
	   	data: '020000000001018fde003a3ccc3381a60f037d2c47df82987609693efcce6798c126d711ed05140000008000ffffffff010098286d590a000000160014cc1b07838e387deacd0e5232e1e8b49f4c29e484029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb4070070d542bdadc230b837710ddcd228101f05c3e80b7fbfc32841b145444879421d00000000802c6d590a00000047304502206302348efb273a0f8be59192b96fb64cc98240c59999e989b31009c94fb35639022100eb2c91ae04eb7d077ee8b96645bee0e77af5687f3d65c5c91c7a7adb7d82182f17a9140a37a91a9df09d9b1f782cb3749e3c3a5bea8c078700000000',
		txid: 'a80fde3059c924a86b1f9dc141385ace3f5ffce5b32316af5d8525de697e2034',
		hash: 'c5053bce2cd4daead4e9858e74439bb94ae600a40c2d9edbe244e22389a41b95',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
		data: '020000000001016ed12ad09d12f33b3cb282e55b912a75768b90782ebf8000f83894a3de5d905b0000008000ffffffff010098be8a31240000001600145771f35d5fb212bf855900883bf92ce75c340c95029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb40700509ef998a76feebe67f8c79ee6afc63eeecbf02f82a235eee484ef109048b8790000000080c28a3124000000473045022014ee08b0ca31e5a45401d134ac2621915d7d934547ba2c6180d17b9285b93d2e022100d1930158b1cdd5271de3efe19ba540bd22e5dc0c401a776969cfc039614f289817a914aa0bf9be098b0105d47a5489dcb98ae4d9f89dd08700000000',
		txid: 'da0a133b65c51b65f008b90c6fdfc5c4883ea02bc0f0bb78e1ddd8454f8ecd62',
		hash: '1b5422e1a38112eaa0d1ae74d6f9a3ade97b24de54e50109c6e782c53ea775b5',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
		data: '020000000001013c9384cfe2f8f2a9bbb8d337d641a778acfba38f9f3753c8483eede25b043d0e0000008000ffffffff01009899d0c3070000001600143bc28d6d92d9073fb5e3adf481795eaf446bceed029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb407006383b637726bbd7f4745a879e29a3f24ea5ba654ffa18083345abf66f339fa7500000000809dd0c307000000473045022100dea58c3cb2296e07f83f23de51a2cba0360d3d96658f32467550909daffae8e1022045ab10f7f2c694d78b89fdcf3af9e065f9620f14ca4732eb185499c26d6126c117a914d99667de9eae834eb490920baf16cdeffe6ba7e38700000000',
		txid: '92e9a97325cee5edde5b5aa0ac1c09d3668b2090eb85447d446e6db8b2ea3a7f',
		hash: '9658148db29474db90057c7fa177a9b2532d22a1b18516eba834acff8caab40f',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
		data: '0200000000010193999be3de97a30d477256caa98919cc18a94eb41a37ab1b92d92a515cb1143a0000008000ffffffff0100982fee9b21000000160014e9d6beb11e577770ad1b6e4129a03554efbdca52029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb4070084e7a5fbbf22d36daa2c7509a35432a6f50b9f0bae01913aff9c8b6dbf468041000000008033ee9b21000000473045022022efe0cc855a449481d29fc4930ee059ba95e6e1fd8f6fa8a61c8c37bc216b28022100c43cbf099b289115652d5415a00dac1d8f857b7cc8fa60a8d473d848b1a3633b17a914b06a1a3636fcc59682852ec1b65d6da2ea36d7688700000000',
		txid: 'ae2a4b770a4b70e94abf83026781174c37ad2b45648a1605b74c76514d7bcc9a',
		hash: 'b4bd616e57af7a13c84d1c36e400c248f2898f4e2d8fbba337597323a8024167',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
		data: '020000000001017feb9a418e947889800e493f1961d11176e49b67ca38536a309fdf5d5b7194e00000008000ffffffff0100980a342e05000000160014531260aa2a199e228c537dfa42c82bea2c7c1f4d029b6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb4070055c688368f0ba0387eb5bae25dda58a3be6b5d4521d5440133845443031589c600000000800e342e05000000463044022020719e0489d9efe6753c9ba9fb958668bc9702bfe6d16792f83c17f1470ccd7e022027b63c1abd2344b6841da2e9932af5a192e53f2ba489387021963410dfec54e517a914c0823ccd13153c38163ed90d8678d6825363293e8700000000',
		txid: 'a159b27503a200ca01853e048c62aba03c73bdfad90de9cd1a074d006861869c',
		hash: '9a0f66ba2311f764986462c35b0bd44feeac0394fd9e209cf1488cd20891d3d2',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 515
	}, {
		data: '02000000000101057ba5fb16d4b0b2f3c29e2e3ea6d51c84545570ebffb9381980d713f76578140000008000ffffffff01009846a6840f00000016001492a01e34e09d999339ee9f2e4991e1c2571e7e95029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb40700efbac498fea9a1444fa8f5511e12b690dd9970f891bbb6a1931171ff9af9967500000000804aa6840f00000047304502202c9f9054ab973d8ed3a9bbf97914e106d51d8e9be0afa981bacec6d663bbe252022100ac3980d64deda94b6ac8c2a882c64dea0fbf9ca38e188afe71a643fa795c697117a914bf8724528efa166065398410aa1dc108284456c48700000000',
		txid: '241ad93fe16ce2be9ec0ebfb68d7ac48af59e86fca6acf06f9f9e355dc3c9cde',
		hash: '4cab11d0207df8684c36acf0a9f2539ed04a5c182994eb7e4db896fac5328364',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
		data: '020000000001010ece6020589c01f4f19300c173b787512608f50a36ffc925fda83f789a5b7f110000008000ffffffff01009811b5701c000000160014931a1af5d4f4858babe973d19cba07c041312d4d029b6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb407003155f3e76087dd69600a20d7ab5b8b1a68dec6ac25f6cfd5beeca4a1af782e6d000000008015b5701c00000046304402207328dbafd7145ccc1de2306f9648addb9048c80d73b3b0f4a930f3f5629c0ecd02200feaf04dcc823419e6e557786893f27e0e093081c3a3977705766fa3bad36c9017a9149f70373139bacbbccbffe063a622d0caa377cafd8700000000',
		txid: '49faf6235feb96032121395e13dc09c848fd72549315f867228e9ca5165cc7e5',
		hash: 'cbaa9b4ee0f7880d38ad25ed2606cbe6e6c42ceb552eed82a22b14b46a9d11bb',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 515
	}, {
		data: '02000000000101918cd13d4c0bd17a895b69b53f2cd2db21252b4e41545bfea677cd4a3052fe700000008000ffffffff01009864dfaf14000000160014fce9025e95033dd6492459bd514883cf3911ee6e029c6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb40700284fb99872c3a5feeedd51fce9dfc01a0b59f076b383ab4e19235073d3a819ce000000008068dfaf1400000047304502207be67fc9cc84becca01213d423cfd2720cd23a8bf4592bdc24aafb39b482aee70221008c728f37f13d92db630e564328c06e0cc5227543bea2c76ef5b54e0b0533886317a914dd85c7f2c88e711315f00123237fedd2198ef30a8700000000',
		txid: '8099883fe658036d4e157eff797ff36bdbce86cb837623b4a98e6a07899f5bf3',
		hash: '9325b28769a97b8dccf3ecb9ee9634e6fe380d528e1654b3c60bcd50d6221df2',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 516
	}, {
		data: '02000000000101a7cc39d554eee63bcaa901f042d47bf292e2c8e1e634ce1bc73279c39933d4f80000008000ffffffff010098d5421a120000001600140c15a4a3e98104afbf77fd7b9256164d41d3cfe4029d6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb40700d5a08a34981324757c15189c3cf3c638c9e438e80585d6b83bd432b8e2cb5c290000000080d9421a12000000483046022100f698deb5e1abcff955a964b5ad4f1a35c6e33ec9b10a36b3078f331507e08c7c022100be739b5dacd76752d24d636a1dd2d60cbc980dc94b5c44684ee96185a64ea01117a9141c3905385d37ed53a6e07fb2d104905ba2c63e858700000000',
		txid: '856694dff629e3cc87506a95d2b96b03f707ec5230be673fa556a6d0c395e90a',
		hash: '0bc44b6f102095cc040f2e5724484487608e53756e5910d863cc0119082f47ad',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 517
	}, {
		data: '0200000000010196cef8f8c321314dad5f8e2b11796a3940556304456afc688a9577aa96b510620000008000ffffffff0100987b979802000000160014fc7250a211deddc70ee5a2738de5f07817351cef029d6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb40700043e7f7e59321ba6764a445f4c26113c29bc11fe2558f73a2a9daa2274afb3b400000000807f979802000000483046022100f4c90a8632d0f588b0eb5a9aa96e7cbbd4a9fd8fd0fcad79b69081e63a30ea10022100d9d1376414f3868e3a37317c466e85600f45148f5a7e33a05912c7475a3941cc17a91452a0dadbbba37e61f22714b760d875a24c8928a38700000000',
		txid: 'e2a6346c9899b47d538b364284900c624a554bd5ec35f29747051642230ded31',
		hash: 'd4f0675a91a89dec577fa24ca7405a31184909a54942cc62317c4bfc46885028',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 517
	}, {
		data: '02000000000101d686a65e510a882ed4d992bca21d070c8c89d8d29c6052d85c529040becfeafa0000008000ffffffff010098f37b4517000000160014d2d97901ebbbaf97bbe7c7ac41ca578244d550a2029d6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb40700e3451ace33865583100b02646150e5687c9b8b630f520151d65aa8494dc1f7a60000000080f77b4517000000483046022100c9e47868ea5a707a2b7f92aac0a9d18870d0b1d41953cc30f7e3abfcfce936a50221008a9bea9523d5ef5d02c8381271afb07d1d0f32724365441633440fafcc123c9c17a9149ad075ba00c1adff9db16f5a10c604748e042f288700000000',
		txid: 'c1c9a9142bcb0cbc29a93448585dbc24f46859d7f1c437f665e799810aa06d6d',
		hash: '71b84c4b932e974fad30055ca95ff02e40a44d4d2fa28103e9ddc636608961a1',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 517
	}, {
		data: '020000000001014ce66a527e40034aa5f80ba782c6a85e31065ff0c11daea9526d4dabc097c4250000008000ffffffff0100988218db19000000160014113163f08f3587892b3b6df7d40f598b8037338e029d6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb407008085abc3eb4690736317d2c0b8db4f2ff5c0fe0a7f776c1352431c08108c567300000000808618db19000000483046022100ed3254776f08c9883b0f94f0879abbc9d9b227e5c6f90c1315cc1a3c5badf5c1022100c2454a4a772aa756834f280b959e32ec604905f75a4490864a8abb6981c1e41e17a914abd698d177a8ad3aa6bd3cd72cbd956340c130828700000000',
		txid: 'd7fa6b6141858443481cd800c2c8e498638c65a1d6ee326d10f05948e763cb9d',
		hash: '3ca8465496df72484dbf93422940857fb7ee062866fc0c2ef8f1e0591f0f1dc2',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 517
	}, {
		data: '02000000000101166f12836b134311b89f36d8aa85cf1916b632da52bf12629b40ed274727fa3f0000008000ffffffff010098b709ef0c000000160014e1fae3324e28a4ef5ee01f14dd337ac6c85d1d90029d6e6b62706fe28c0ab6f1b372c1a6a246ae63f74f931e8365e15a089c68d6190000000000bdb407007f0394ab4eb18c779eea27ae6b94af6b7d549632d455b83a51401754d2db82810000000080bb09ef0c000000483046022100d48587135165d501d2bd50eb57dcda4a47d1db9a9108313fcc3b9d6f96c88b8b022100e59632cf275528b4a63b64d618f9f21df73143c570df481a84eb0e807cff80ef17a914b90115ecda26d384b8359856db0ede4e57b339328700000000',
		txid: '4f4011a3ebb5e35c0ba21b8f83a73347a934e8696137a397ad15570e7fe317e5',
		hash: 'f03e30473f66800745bd02559c710a0d6b2851c239e476e66b576cb077baa5ae',
		depends: [],
		fee: 1000,
		sigops: 1,
		weight: 517
	}, {
		data: '0200000000010278a71f3b51b5ab7140791a27615c4ecc4b85e16ff4db3580bfe3ab25d32f01d60200000000ffffffff78a71f3b51b5ab7140791a27615c4ecc4b85e16ff4db3580bfe3ab25d32f01d60300000000ffffffff060077de00ff00000000160014e1fae3324e28a4ef5ee01f14dd337ac6c85d1d900953706963265370616eb758130800000000160014e1fae3324e28a4ef5ee01f14dd337ac6c85d1d9000fdf7d2ac000000001600145771f35d5fb212bf855900883bf92ce75c340c950953706963265370616e0fceb504000000001600145771f35d5fb212bf855900883bf92ce75c340c95000f39048e03000000160014531260aa2a199e228c537dfa42c82bea2c7c1f4d0953706963265370616e02864e1300000000160014531260aa2a199e228c537dfa42c82bea2c7c1f4d024730440220434443f5c668b9c50e64abfac6e833ed278625e2142a883fa3a20b6eb8ddcb2202200b17b98a97ca059351e3837fcd4cd16b5361a74d2268ea5cf7bd0f8011a05347012102466d7fcae563e5cb09a0d1870bb580344804617879a14949cf22285f1bae3f2702483045022100e06798ec471fd1ebfd4a038a433e8decd55e7a48cccdcc4a0117a24c0f1439a502200d9c0cf0ebfb4da4f9934b33f7ada3ab16c848b5662333270089c3a11ad94411012102466d7fcae563e5cb09a0d1870bb580344804617879a14949cf22285f1bae3f2700000000',
		txid: '8ff397029836f07856540a8219dbdd29201987cad8da7521e0bf86a158ef592a',
		hash: '24f7bcd403c5ff5dbed84a1ac9f51e035804ed5477621a150c2247195066cfef',
		depends: [],
		fee: 2000,
		sigops: 2,
		weight: 1461
	} ],
	coinbaseaux: { flags: '' },
	coinbasevalue: 167000,
	longpollid: '000001557bbc5a0f9b307bbf0497541caa12da8425a79f0da0dcfec6baf5e81e832',
	target: '000001ffff000000000000000000000000000000000000000000000000000000',
	mintime: 1537992935,
	mutable: [ 'time', 'transactions', 'prevblock' ],
	noncerange: '00000000ffffffff',
	sigoplimit: 80000,
	sizelimit: 4000000,
	weightlimit: 4000000,
	curtime: 1537994318,
	bits: '1e01ffff',
	height: 49,
	default_witness_commitment: '6a24aa21a9edf94cc29f3b30b3a3fd9890f6cab886d08175aac5e88d7790a9d06c76fed1cf24' 
};


function getBlockTemplate(obj, cb) {
	if (!cb && typeof obj === 'function') {
		cb = obj;
		obj = undefined;
	}
	if (typeof cb !== 'function') {
		cb = function() {};
	}
	let param = Object.assign({}, baseParam);
	if (typeof obj === 'object') {
		param = Object.assign(param, obj);
	}

	let id = Math.round(Math.random() * 100000);
	//console.log('ID', id);
	let reqData = Buffer.from(JSON.stringify({
		jsonrpc: '1.0',
		id: id.toString(),
		method: 'getblocktemplate',
		params: {
			template_request: {
				//mode: "template",
				//capabilities: [],
				rules: [ 'csv', 'segwit' ]
			}
		}
	}));
	//console.log('param', reqData.toString());

	const options = {
		hostname: param.rpcHost,
		port: param.nRPCPort,
		method: 'POST',
		auth: param.rpcUser + ':' + param.rpcPassword,
		timeout: param.callTimeout,
		headers: {
			accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
			//'accept-encoding': 'gzip, deflate, sdch, br',
			'accept-language': 'en-US,en;q=0.8',
			'Content-Type': 'application/json; charset=UTF-8',
			'Content-Length': reqData.length,
			'user-agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.3'
		}
	};

	let get_req = http.request(options, function(res) {
		//res.setEncoding('utf8');	
		if (isMain) console.log(res.statusCode);
		//if (isMain) console.log(res.headers);
		let chunks = [];
		res.on('data', function (chunk) {
			chunks.push(chunk);
		});
		res.on('end', function() {
			let ans = {};
			try {
				ans = JSON.parse(chunks.join(''));
			} catch (e) {
				ans.error = e;
				ans.rawData = chunks.join('');
			}
			//console.log(ans);
			if (ans.error) {
				if (isMain) console.log('ERROR:', ans.error);
				cb(ans);
			} else if (res.statusCode != 200) {
				ans.error = 'http response';
				ans.code = res.statusCode;
				cb(ans);
			} else {
				if (isMain) console.dir(ans.result, {showHidden: true, depth: 99, colors: true});
				param.blockData = ans.result;
				cb(undefined, param);
			}
		});
	});
	get_req.on('error', function(e) {
		console.log('CONN ERR:', e);
	});
	get_req.end(reqData);
	//console.log("Query page");
};

function getBlockchainInfo(obj, cb) {
	if (!cb && typeof obj === 'function') {
		cb = obj;
		obj = undefined;
	}
	if (typeof cb !== 'function') {
		cb = function() {};
	}
	let param = Object.assign({}, baseParam);
	if (typeof obj === 'object') {
		param = Object.assign(param, obj);
	}

	let id = Math.round(Math.random() * 100000);
	//console.log('ID', id);
	let reqData = Buffer.from(JSON.stringify({
		jsonrpc: '1.0',
		id: id.toString(),
		method: 'getblockchaininfo',
		params: {}
	}));
	//console.log('param', reqData.toString());

	const options = {
		hostname: param.rpcHost,
		port: param.nRPCPort,
		method: 'POST',
		auth: param.rpcUser + ':' + param.rpcPassword,
		timeout: param.callTimeout,
		headers: {
			accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
			//'accept-encoding': 'gzip, deflate, sdch, br',
			'accept-language': 'en-US,en;q=0.8',
			'Content-Type': 'application/json; charset=UTF-8',
			'Content-Length': reqData.length,
			'user-agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.3'
		}
	};

	let get_req = http.request(options, function(res) {
		//res.setEncoding('utf8');	
		if (isMain) console.log(res.statusCode);
		//if (isMain) console.log(res.headers);
		let chunks = [];
		res.on('data', function (chunk) {
			chunks.push(chunk);
		});
		res.on('end', function() {
			let ans = {};
			try {
				ans = JSON.parse(chunks.join(''));
			} catch (e) {
				ans.error = e;
				ans.rawData = chunks.join('');
			}
			//console.log(ans);
			if (ans.error) {
				if (isMain) console.log('ERROR:', ans.error);
				cb(ans);
			} else if (res.statusCode != 200) {
				ans.error = 'http response';
				ans.code = res.statusCode;
				cb(ans);
			} else {
				if (isMain) console.dir(ans.result, {showHidden: true, depth: 99, colors: true});
				param.blockData = ans.result;
				cb(undefined, param);
			}
		});
	});
	get_req.on('error', function(e) {
		console.log('CONN ERR:', e);
	});
	get_req.end(reqData);
	//console.log("Query page");
};

function submitBlock(obj, cb) {
	if (!cb && typeof obj === 'function') {
		cb = obj;
		obj = undefined;
	}
	if (typeof cb !== 'function') {
		cb = function() {};
	}
	let param = Object.assign({}, baseParam);
	if (typeof obj === 'object') {
		param = Object.assign(param, obj);
	}

	let id = Math.round(Math.random() * 100000);
	//console.log('ID', id);
	let reqData = Buffer.from(JSON.stringify({
		jsonrpc: '1.0',
		id: id.toString(),
		method: 'submitblock',
		params: [
			param.hex
		]
	}));
	//console.log('param', reqData.toString());

	const options = {
		hostname: param.rpcHost,
		port: param.nRPCPort,
		method: 'POST',
		auth: param.rpcUser + ':' + param.rpcPassword,
		timeout: param.callTimeout,
		headers: {
			accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8',
			//'accept-encoding': 'gzip, deflate, sdch, br',
			'accept-language': 'en-US,en;q=0.8',
			'Content-Type': 'application/json; charset=UTF-8',
			'Content-Length': reqData.length,
			'user-agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/57.0.2987.133 Safari/537.3'
		}
	};

	let get_req = http.request(options, function(res) {
		//res.setEncoding('utf8');	
		if (isMain) console.log(res.statusCode);
		//if (isMain) console.log(res.headers);
		let chunks = [];
		res.on('data', function (chunk) {
			chunks.push(chunk);
		});
		res.on('end', function() {
			let ans = {};
			try {
				ans = JSON.parse(chunks.join(''));
			} catch (e) {
				ans.error = e;
				ans.rawData = chunks.join('');
			}
			//console.log(ans);
			if (ans.error) {
				if (isMain) console.log('ERROR:', ans.error);
				cb(ans);
			} else if (res.statusCode != 200) {
				ans.error = 'http response';
				ans.code = res.statusCode;
				cb(ans);
			} else {
				let rsp = !ans.result ? 'SUCCESS' : ans.result;
				if (isMain) console.dir(rsp, {showHidden: true, depth: 99, colors: true});
				cb(undefined, rsp);
			}
		});
	});
	get_req.on('error', function(e) {
		console.log('CONN ERR:', e);
	});
	get_req.end(reqData);
	//console.log("Query page");
};

function defaultPow(block, bits) {
	for (let i = 0; i < 0x100000000; i++) {
		block.nNonce = i;
		let hash = block.getHash();
		let zero = 0;
		for (let j = hash.length - 1; j > 0; j--){
			if (hash[j] != 0) {
				zero *= 8;
				if (hash[j] & 0x80)
					break;
				zero++;
				if (hash[j] & 0x40)
					break;
				zero++;
				if (hash[j] & 0x20)
					break;
				zero++;
				if (hash[j] & 0x10)
					break;
				zero++;
				if (hash[j] & 8)
					break;
				zero++;
				if (hash[j] & 4)
					break;
				zero++;
				if (hash[j] & 2)
					break;
				zero++;
				break;
			}
			zero++;
		}
		if (zero >= bits)
			return true;
	}
	return false;
};

function generateBlock(obj, cb) {
	if (!cb && typeof obj === 'function') {
		cb = obj;
		obj = undefined;
	}
	if (typeof cb !== 'function') {
		cb = function() {};
	}
	let param = Object.assign({}, baseParam);
	if (typeof obj === 'object') {
		param = Object.assign(param, obj);
	}

	let coinbase = new info.Transaction();
	coinbase.nVersion = 2;
	let vin = new info.TxIn();
	coinbase.vin.push(vin);

	vin.prevout = new info.OutPoint();
	vin.prevout.hash = Buffer.alloc(32, 0);
	vin.prevout.n = 0xFFFFFFFF;
	let baseBuf = new info.BufferStream();
	baseBuf.writeBuffer(info.CScriptPushInt64(param.blockData.height));
	baseBuf.writeScriptVector(Buffer.concat([
		Buffer.from('BEEFCAFE', 'hex'),
		crypto.randomBytes(32),
		Buffer.from('01000000BEEFCAFE', 'hex')
	]));
	baseBuf.writeUInt8(0);
	baseBuf.writeScriptVector(param.minerSign, 'utf8');
	baseBuf.writeUInt8(0);
	vin.scriptSig = new info.Script().fromBuffer(baseBuf.getData());

	coinbase.hasWitness = true;
	vin.scriptWitness = [];
	vin.scriptWitness.push(new info.Script().fromBuffer(Buffer.alloc(32)));

	// 1
	let vout = new info.TxOut();
	coinbase.vout.push(vout);

	vout.nValue = param.blockData.coinbasevalue;
	vout.scriptPubKey = new info.Script().fromBuffer(Buffer.concat([Buffer.from([0, 20]), param.walletAddress]));

	// 2
	vout = new info.TxOut();
	coinbase.vout.push(vout);

	vout.nValue = 0;
	vout.scriptPubKey = new info.Script().fromBuffer(Buffer.from(param.blockData.default_witness_commitment, 'hex'));

	// 3
	vout = new info.TxOut();
	coinbase.vout.push(vout);

	vout.nValue = 0;
	let bblockSign = new info.BufferStream();
	bblockSign.writeString('nkbs', 'binary');
	bblockSign.setHashMark();
	bblockSign.writeBuffer(Buffer.alloc(32));
	bblockSign.writeUInt32LE(0xFFFFFFFF);
	bblockSign.writeUInt64LE(100 * 100000000);
	bblockSign.writeBufferSized(baseParam.signKey.publicKey);
	let tag = bblockSign.getData();
	let bs = new info.BufferStream();
	bs.writeUInt8(0x6a);	// OP_RETURN
	bs.writeScriptVector(tag);
	vout.scriptPubKey = new info.Script().fromBuffer(bs.getData());

	if ('feesharing' in param.blockData) {
		param.blockData.feesharing.forEach(function(data) {
			vout = new info.TxOut(data);
			coinbase.vout.push(vout);
		});
	}

	let block = new info.Block();
	block.nVersion = param.blockData.version;
	block.hashPrevBlock = Buffer.from(param.blockData.previousblockhash, 'hex').reverse();
	block.nTime = Math.floor(Date.now() / 1000);
	block.nBits = Buffer.from(param.blockData.bits, 'hex').readUInt32BE(0);
	block.vtx.push(coinbase);
	let flagCommit = false;
	param.blockData.transactions.forEach(function(o) {
		let tx = new info.Transaction(Buffer.from(o.data, 'hex'));

		// Malleability test
		// if (Buffer.from('a91bdf051007a541cfe150c887f9c90f237de500f7757c5d97fee9c79b2d6dfb', 'hex').reverse().equals(tx.hash)) {
		// 	tx.vout[0].scriptPubKey = new info.Script().fromBuffer('00145771f35d5fb212bf855900883bf92ce75c340c95');
		// 	//console.log(tx.getHash().toString('hex'));
		// 	//tx.getHash();
		// 	console.log(tx.getHashWitness().toString('hex'));
		// 	//tx.getHashWitness();
		// 	flagCommit = true;
		// }

		block.vtx.push(tx);
	});
	if (flagCommit) {
		let h = info.Hash256(block.getMerkleCommit(), Buffer.alloc(32));
		h.copy(coinbase.vout[1].scriptPubKey.script, 6);
	}
	block.getMerkle();
	//param.powFunc(block, 23);
	param.powFunc(block, 14);

	bblockSign.writeBuffer(block.getHash());
	let signature = bblockSign.getSignature(param.signKey.skPem);
	console.log('Signature', signature.toString('hex'));
	vin.scriptWitness.push(new info.Script().fromBuffer(signature));

	param.hex = block.toBuffer().toString('hex');
	//console.log(param.blockData.transactions.length, hex);
	submitBlock(param, cb);
};

function test(e, d) {
	if (e)
		throw e;
	d.transactions.forEach(function(o) {
		let tx = new info.Transaction(Buffer.from(o.data, 'hex'));
		console.log(tx.getHash().reverse().toString('hex'));
		console.log(o.txid);
		console.log(tx.getHashWitness().reverse().toString('hex'));
		console.log(o.hash);
	});
}
//test(undefined, example2);
